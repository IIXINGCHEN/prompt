# 开发指南

## 开发哲学

### 核心信条

- **增量优于大爆炸** - 小步快跑，持续集成。
- **借鉴优于独创** - 在实现前先研究和学习现有代码。
- **务实优于教条** - 适应项目现实，不拘泥于形式。
- **意图清晰优于代码巧妙** - 让代码不言自明，简单直白。

### 简洁之道

- **单一职责**：每个函数/类只做一件事。
- **避免过早抽象**：在必要时才进行抽象。
- **拒绝奇技淫巧**：选择简单质朴的方案。
- **无需解释**：如果一段代码需要注释才能看懂，那它就太复杂了。

***

## 开发流程

### 1. 阶段性规划 (Staging Plan)

将复杂工作分解为3-5个可验证的阶段，并记录在 `IMPLEMENTATION_PLAN.md` 文件中：

```markdown
## 阶段 N：[阶段名称]
**目标**：[明确的可交付成果]
**验收标准**：[可被测试验证的结果]
**关键测试点**：[需要覆盖的核心测试用例]
**状态**：[未开始 | 进行中 | 已完成]
````

  - 随时更新计划状态。
  - 所有阶段完成后删除此文件。

### 2\. 实现流程 (红-绿-重构)

1.  **理解** - 深入研究代码库中的既有模式。
2.  **测试先行** - 先编写失败的测试（**红灯**）。
3.  **快速实现** - 用最少的代码让测试通过（**绿灯**）。
4.  **优雅重构** - 在测试持续通过的前提下，优化代码结构。
5.  **清晰提交** - 提交信息需清晰，并关联到开发计划。

### 3\. 脱困策略 (三振出局法)

**核心原则**：针对同一问题，主动尝试不超过**3**次。如果仍然卡住，必须**停下**并转换思路。

1.  **复盘失败**：

      - 尝试了哪些方法？
      - 遇到了什么错误？
      - 你认为失败的根本原因是什么？

2.  **寻找替代方案**：

      - 研究2-3个类似的参考实现。
      - 分析并记录它们的不同处理方式。

3.  **回归本源**：

      - 当前的抽象是否过度或不足？
      - 问题能否被进一步拆解？
      - 是否存在一个更简单、根本不同的解法？

4.  **切换攻击角度**：

      - 换个库或框架的特性试试？
      - 换种架构模式来思考？
      - 尝试减少抽象，而不是增加它？

-----

## 技术标准

### 架构原则

  - **组合优于继承** - 优先使用依赖注入。
  - **接口优于实现** - 面向接口编程，方便测试与扩展。
  - **显式优于隐式** - 保持清晰的数据流和依赖关系。
  - **修复测试优于禁用** - 绝不跳过或禁用失败的测试。

### 代码质量

  - **每次提交必须**：

      - 成功编译。
      - 通过所有相关测试。
      * 为新功能提供单元测试。
      - 符合代码风格和静态检查规范。

  - **提交前检查**：

      - 运行格式化与静态检查工具。
      - 自我 Code Review。
      - 确保提交信息解释清楚“为什么”这样修改。

### 异常处理

  - **快速失败**，并提供有意义的错误信息。
  - **包含上下文**，方便快速定位问题。
  - **分层处理**，在最合适的层级捕获和处理异常。
  - **严禁“吞掉”异常**，不能对异常静默处理。

-----

## 决策框架

当存在多种有效方案时，按以下优先级进行决策：

1.  **可测试性** - 这个方案容易编写自动化测试吗？
2.  **可读性/可维护性** - 半年后，其他人能轻松理解和修改吗？
3.  **一致性** - 这个方案是否遵循了项目现有的设计模式？
4.  **简洁性** - 这是能解决问题的最简单的方案吗？
5.  **可逆性** - 如果未来证明这个决策是错的，撤销它的成本有多高？

-----

## 融入项目

### 熟悉代码库

  - 找到3个与当前任务相似的功能或组件。
  - 识别并遵循其中通用的设计模式和代码约定。
  - 尽可能复用项目中已有的库和工具函数。
  - 遵循项目中已有的测试风格和模式。

### 工具链

  - 使用项目既有的构建系统。
  - 使用项目既有的测试框架。
  - 使用项目既有的代码风格和静态检查配置。
  - 在没有充分论证前，不引入新的开发工具。

-----

## 质量门 (Quality Gates)

### “完成”的定义 (Definition of Done)

  - [ ] 单元测试和集成测试已编写并通过。
  - [ ] 代码遵循项目的规范和约定。
  - [ ] 没有静态检查或格式化工具的警告。
  - [ ] 提交信息清晰、规范。
  - [ ] 最终实现与设计计划一致。
  - [ ] 代码中没有不关联任务ID的`TODO`。

### 测试准则

  - **测试行为，而非实现细节**。
  - 尽可能做到**一个测试只验证一个场景**。
  - **测试命名要清晰**，能描述出测试的场景和预期结果。
  - **复用**项目中已有的测试辅助工具和函数。
  - **测试必须是确定性的**，杜绝不稳定的测试。

-----

## 重要提醒

### 行为红线 (NEVER)

  - **绝不**使用 `--no-verify` 等参数绕过代码质量检查。
  - **绝不**为了省事而禁用或注释掉失败的测试。
  - **绝不**提交无法编译或无法运行的代码。
  - **绝不**凭空猜测，必须通过分析现有代码来验证假设。

### 黄金法则 (ALWAYS)

  - **始终**以小步、可工作的方式增量提交代码。
  - **始终**在开发过程中同步更新你的计划文档。
  - **始终**从项目中已有的优秀实现中学习。
  - **始终**在连续3次尝试失败后停下，并启动脱困策略。
